# Sync Spec

## 目的

`scripts/inotify-sync.ts` の責務を明確化し、`content/` から `site/` への変換フローを統一する。

## 対象

- 入力: `content/` 配下のMarkdownとアセット
- 出力: 各 `site/<domain>/` が読み込む中間データ（Markdown/JSON等）

## 責務

- ファイル変更監視（追加・更新・削除）
- frontmatter の基本検証
- サイトルールに沿った出力形式への変換
- 出力先の差分更新

## 非責務

- 開発サーバの起動
- ブラウザプレビュー
- Astroビルドの制御

## 最小要件

- `content/<domain>/` の変更を該当 `site/<domain>/` のみに同期
- `README.md` 本文とfrontmatterを保持して変換
- アセット（画像等）を相対参照が壊れない形でコピー
- 削除イベント時に出力側も追従削除
- Markdown内リンク/画像の `./` 始まりパスはローカルアセット参照とみなし、`/posts/<slug>/...` にrewriteする

## エラー時の挙動

- frontmatter不正時は対象記事のみ同期失敗として記録
- 他記事の同期処理は継続
- 終了コードは失敗を検知できる値を返す

## 将来拡張

- 増分ビルド用のキャッシュ
- サイト別の変換プラグイン
- CI向けワンショット同期モード
